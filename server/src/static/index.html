<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Streamarrfs - Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/mvp.css">
  <!-- <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"> -->


</head>

<body>

  <div class="container">
    <div class="stats">
      <h1>streamarrfs</h1>
      <h2>stats</h2>

      <div>
        <div id="sse" hx-ext="sse" sse-connect="/api/streamarrfs/sse">
          <!-- Data will be populated dynamically -->
          <div id="sse2" sse-swap="message" style="display: none;"></div>
        </div>
        <h3>Streaming torrents</h3>
        <table id="streamingTorrents">
          <thead>
            <tr>
              <th>Name</th>
              <th>Ready</th>
              <th>Download Speed</th>
              <th>Upload Speed</th>
              <th>Downloaded</th>
              <th>Paused</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
        <h3>Indexing torrents</h3>
        <table id="indexingTorrents">
          <thead>
            <tr>
              <th>Name</th>
              <th>Ready</th>
              <th>Download Speed</th>
              <th>Upload Speed</th>
              <th>Downloaded</th>
              <th>Paused</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>

      </div>
    </div>

  </div>


  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const streamingTableBody = document.getElementById('streamingTorrents').querySelector('tbody');
      const indexingTableBody = document.getElementById('indexingTorrents').querySelector('tbody');

      // Listen for SSE updates
      document.querySelector('#sse').addEventListener('htmx:sseMessage', function (event) {
        const data = JSON.parse(event?.detail?.data || '[]');
        renderTorrents(streamingTableBody, data.streamingTorrents);
        renderTorrents(indexingTableBody, data.indexingTorrents);
      });

      function renderTorrents(tBody, torrents) {
        tBody.innerHTML = ''; // Clear previous data
        torrents.forEach(function (torrent) {
          var row = document.createElement('tr');
          row.innerHTML = `
                        <td>${torrent.name}</td>
                        <td>${torrent.ready}</td>
                        <td>${torrent.downloadSpeed}</td>
                        <td>${torrent.uploadSpeed}</td>
                        <td>${torrent.downloaded}</td>
                        <td>${torrent.paused}</td>
                        <td>${torrent.status}</td>
                    `;
          tBody.appendChild(row);
        });
      }
    });
  </script>
  <script src="https://unpkg.com/htmx.org/dist/htmx.js"></script>
  <script src="https://unpkg.com/htmx.org/dist/ext/sse.js"></script>

</body>

</html>